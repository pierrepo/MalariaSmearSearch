{% extends "skeleton.html" %}

{% block head %}

    {{super()}}

    <link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.1/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.1/cropper.min.js"></script>

    <style>

        #chunk{
            /* According to Cropperjs documentation :
             "Limit image width to avoid overflow the container
             This rule is very important, please do not ignore this! "*/
            max-width: 100%;
        }

    </style>
{% endblock %}

{% block content %}
    <div style="height: 500px; width: 500px;">
        {% set path = '1_0_0.jpg' %}
        {{path}}
        <img id='chunk' src={{url_for('static', filename = "test/"+path )}} alt="a chunk of an uploaded image" >
    </div>

    <form action="" id="add-new">
        <input type="number" id = 'add-sel-x' readonly>
        <input type="number" id = 'add-sel-y' readonly>
        <input type="number" id = 'add-sel-width' readonly>
        <input type="number" id = 'add-sel-height' readonly>

        <select  id="new-list-item-text" name="new-list-item-text">
            <option selected="selected" disabled="disabled">Select an annotation</option>
            <option value="parasite">parasite</option>
            <option value="red">red cell</option>
            <option value="white">white cell</option>
            <option value="other">other</option>
        </select>

        <input type="submit" id="add-new-submit" value="Add" class="button" />

    </form>

    <script type="text/javascript" src="{{ url_for('static', filename='js/annotation.js') }}"></script>
    <script>
        initialize()
    </script>
    {{ url_for('static', filename='js/annotation.js') }}

    <script>
    var chunk = document.getElementById('chunk');

    var add_sel_x = document.getElementById('add-sel-x')
    var add_sel_y = document.getElementById('add-sel-y')
    var add_sel_width = document.getElementById('add-sel-width')
    var add_sel_height = document.getElementById('add-sel-height')

    var cropper = new Cropper(chunk, {
        viewMode :1, //the crop box should be within the canvas
        dragMode : 'move' , //dragging mode of the cropper.

        crop: function(e) {
            console.log(e.detail.x);
            add_sel_x.value = e.detail.x
            console.log(e.detail.y);
            add_sel_y.value = e.detail.y
            console.log(e.detail.width);
            add_sel_width.value = e.detail.width
            console.log(e.detail.height);
            add_sel_height.value = e.detail.height
            //console.log(e.detail.rotate);
            //console.log(e.detail.scaleX);
            //console.log(e.detail.scaleY);
    }
    });


    </script>
{% endblock %}
